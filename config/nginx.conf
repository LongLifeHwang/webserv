# /etc/nginx/nginx.conf

user  nginx;  # User and group under which Nginx worker processes run
worker_processes  auto;  # Number of worker processes (auto detects based on CPU cores)

events {
    worker_connections  1024;  # Maximum number of connections per worker process
}

http {
    include       mime.types;  # Include MIME type definitions
    default_type  application/octet-stream;  # Default MIME type for files

    # Logging format and access log configuration
    log_format  main  '$remote_addr - $remote_user [$time_local] "$request" '
                      '$status $body_bytes_sent "$http_referer" '
                      '"$http_user_agent" "$http_x_forwarded_for"';
    access_log  /var/log/nginx/access.log  main;

    # Enable file transfer optimizations
    sendfile        on;  # Enable efficient file transfers
    tcp_nopush      on;  # Send headers in one packet
    tcp_nodelay     on;  # Disable Nagle's algorithm for small packets
    keepalive_timeout  65;  # Timeout for keep-alive connections

    # Gzip compression
    gzip  on;  # Enable gzip compression
    gzip_disable "msie6";  # Disable gzip for old IE6 browsers

    # Server block for example.com
    server {
        listen       80;  # Listen on port 80
        server_name  example.com;  # Domain name for this server block

        root         /var/www/example;  # Root directory for this server
        index        index.html index.htm;  # Default files to serve

        location / {
            try_files $uri $uri/ =404;  # Try to serve the requested file or directory, return 404 if not found
        }

        # Location block for custom error page
        location = /404.html {
            internal;  # This block is only used internally
        }

        # Proxy requests to a backend server
        location /api/ {
            proxy_pass http://backend-server;  # Replace with your backend server URL
            proxy_set_header Host $host;
            proxy_set_header X-Real-IP $remote_addr;
            proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
            proxy_set_header X-Forwarded-Proto $scheme;
        }

        # Custom error pages
        error_page 404 /404.html;
        error_page 500 502 503 504 /50x.html;

        location = /50x.html {
            internal;  # This block is only used internally
        }

        access_log /var/log/nginx/example.access.log;  # Custom access log for this server block
        error_log /var/log/nginx/example.error.log;    # Custom error log for this server block
    }

    # Server block for another-site.com
    server {
        listen       80;  # Listen on port 80
        server_name  another-site.com;  # Domain name for this server block

        root         /var/www/another-site;  # Root directory for this server
        index        index.html index.htm;  # Default files to serve

        location / {
            try_files $uri $uri/ =404;  # Try to serve the requested file or directory, return 404 if not found
        }

        # Custom error pages
        error_page 404 /404.html;
        error_page 500 502 503 504 /50x.html;

        location = /50x.html {
            internal;  # This block is only used internally
        }

        access_log /var/log/nginx/another-site.access.log;  # Custom access log for this server block
        error_log /var/log/nginx/another-site.error.log;    # Custom error log for this server block
    }
}
